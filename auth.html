<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Autenticando ‚Äî Supremo Tribunal de Oasis</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>

<body>

<p>üîê Finalizando autentica√ß√£o, aguarde...</p>

<script>
(function () {
  try {
    /*
      Worker redireciona assim:
      auth.html#user=JSON_URL_ENCODED
    */

    const hash = window.location.hash;

    if (!hash || !hash.startsWith("#user=")) {
      throw "Payload n√£o recebido";
    }

    // Remove "#user="
    const payloadEncoded = hash.replace("#user=", "");

    // Decodifica o JSON
    const usuario = JSON.parse(decodeURIComponent(payloadEncoded));

    // Valida√ß√£o m√≠nima (SEM rigidez excessiva)
    if (!usuario || !usuario.cid || !usuario.nivel) {
      throw "Usu√°rio inv√°lido";
    }

    // Estrutura PADR√ÉO do sistema
    const usuarioFinal = {
      nome: usuario.nome || "Usu√°rio",
      cid: usuario.cid,
      nivel: usuario.nivel
    };

    // Salva sess√£o
    localStorage.setItem(
      "usuario",
      JSON.stringify(usuarioFinal)
    );

    // Redireciona SEM l√≥gica extra
    window.location.replace("welcome.html");

  } catch (erro) {
    console.error("Erro na autentica√ß√£o:", erro);
    localStorage.clear();
    window.location.replace("index.html");
  }
})();
</script>

</body>
</html>
