<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Autenticando...</title>
</head>
<body>
  <p>Autenticando, aguarde...</p>

  <script>
    const params = new URLSearchParams(window.location.search);
    const payload = params.get("user");

    if (!payload) {
      alert("Erro de autenticação");
      window.location.href = "index.html";
      throw new Error("Payload ausente");
    }

    try {
      const user = JSON.parse(atob(payload));

      const usuario = {
        nome: user.nome,
        cid: user.id,
        nivel: user.nivel || "cidadao"
      };

      localStorage.setItem("usuario", JSON.stringify(usuario));

      window.location.href = "tickets.html";
    } catch (e) {
      console.error(e);
      localStorage.removeItem("usuario");
      alert("Erro ao processar login");
      window.location.href = "index.html";
    }
  </script>
</body>
</html>
