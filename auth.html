<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Autenticando</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>

<body style="
  margin:0;
  font-family: Georgia, serif;
  background: radial-gradient(circle, #7a1c1c, #3b0d0d);
  height:100vh;
  display:flex;
  align-items:center;
  justify-content:center;
  color:#2b2b2b;
">

<div style="
  background:#f8f4ee;
  border-radius:18px;
  padding:30px;
  width:320px;
  text-align:center;
  border:2px solid #d4af37;
">

  <p style="margin-bottom:12px;">
    üîê Autenticando, aguarde‚Ä¶
  </p>

  <p style="font-size:11px; color:#555;">
    Sistema institucional ‚Äî acesso monitorado
  </p>

</div>

<script>
(function () {
  try {
    const hash = window.location.hash;
    if (!hash || !hash.startsWith("#user=")) {
      throw "Payload ausente";
    }

    let raw = hash.replace("#user=", "");
    let usuario;

    try {
      usuario = JSON.parse(decodeURIComponent(raw));
    } catch {
      usuario = JSON.parse(atob(raw));
    }

    if (!usuario || !usuario.id || !usuario.nivel) {
      throw "Usu√°rio inv√°lido";
    }

    localStorage.setItem("usuario", JSON.stringify({
      nome: usuario.nome || usuario.username || "Usu√°rio",
      cid: usuario.id,
      nivel: usuario.nivel
    }));

    location.replace("welcome.html");

  } catch (e) {
    console.error(e);
    location.replace("index.html");
  }
})();
</script>

</body>
</html>
