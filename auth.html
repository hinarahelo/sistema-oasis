<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <title>Autenticando â€” Sistema Oasis</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
</head>

<body>
  <p>ğŸ” Finalizando autenticaÃ§Ã£o, aguarde...</p>

  <script>
    try {
      const hash = window.location.hash.substring(1);
      const params = new URLSearchParams(hash);
      const payload = params.get("user");

      if (!payload) {
        throw new Error("Payload ausente");
      }

      const usuario = JSON.parse(decodeURIComponent(payload));

      // ğŸ”’ Estrutura ÃšNICA usada no sistema inteiro
      const usuarioFinal = {
        nome: usuario.nome,
        cid: usuario.id,
        nivel: usuario.nivel || "cidadao"
      };

      localStorage.setItem("usuario", JSON.stringify(usuarioFinal));

      // ğŸ” Redirecionamento por nÃ­vel
      if (usuarioFinal.nivel === "staff" || usuarioFinal.nivel === "coordenacao") {
        window.location.href = "staff/dashboard.html";
      } else {
        window.location.href = "tickets.html";
      }

    } catch (e) {
      console.error("Erro de autenticaÃ§Ã£o:", e);
      localStorage.clear();
      window.location.href = "index.html";
    }
  </script>
</body>
</html>
