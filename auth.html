<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <title>Autenticando ‚Äî Sistema Oasis</title>
</head>

<body>
  <p>üîê Finalizando autentica√ß√£o...</p>

  <script>
    try {
      const hash = new URLSearchParams(window.location.hash.substring(1));
      const payload = hash.get("user");

      if (!payload) throw "Payload ausente";

      const user = JSON.parse(decodeURIComponent(payload));

      if (!["cidadao", "staff", "coordenacao"].includes(user.nivel)) {
        throw "N√≠vel inv√°lido";
      }

      localStorage.setItem("usuario", JSON.stringify({
        cid: user.id,
        nome: user.nome,
        nivel: user.nivel
      }));

      if (user.nivel === "cidadao") {
        location.href = "tickets.html";
      } else {
        location.href = "staff/dashboard.html";
      }

    } catch (e) {
      localStorage.clear();
      location.href = "index.html";
    }
  </script>
</body>
</html>
