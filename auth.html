<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Autenticando...</title>
</head>

<body>
<p>üîê Finalizando autentica√ß√£o, aguarde...</p>

<script>
try {
  const hash = window.location.hash.substring(1);
  const params = new URLSearchParams(hash);
  const payload = params.get("user");

  if (!payload) throw "Payload n√£o recebido";

  const usuario = JSON.parse(decodeURIComponent(payload));

  const usuarioFinal = {
    nome: usuario.nome,
    cid: usuario.id,
    nivel: usuario.nivel
  };

  localStorage.setItem("usuario", JSON.stringify(usuarioFinal));

  if (usuarioFinal.nivel === "cidadao") {
    location.href = "tickets.html";
  } else {
    location.href = "staff/dashboard.html";
  }

} catch (e) {
  console.error("Erro auth:", e);
  localStorage.clear();
  location.href = "index.html";
}
</script>
</body>
</html>
