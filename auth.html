<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Autenticando ‚Äî Supremo Tribunal de Oasis</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>

<body>
  <p>üîê Finalizando autentica√ß√£o, aguarde...</p>

  <script>
    try {
      /*
        Worker redireciona assim:
        auth.html#user=JSON_ENCODED
      */

      const hash = window.location.hash.substring(1);
      const params = new URLSearchParams(hash);
      const payload = params.get("user");

      if (!payload) throw "Payload ausente";

      const usuario = JSON.parse(decodeURIComponent(payload));

      if (!usuario.nome || !usuario.cid || !usuario.nivel) {
        throw "Usu√°rio inv√°lido";
      }

      /* Estrutura √∫nica do sistema */
      const usuarioFinal = {
        nome: usuario.nome,
        cid: usuario.cid,
        nivel: usuario.nivel
      };

      localStorage.setItem(
        "usuario",
        JSON.stringify(usuarioFinal)
      );

      /* üîÄ Redirecionamento por n√≠vel */
      if (usuarioFinal.nivel === "coordenacao") {
        location.href = "staff/coordenacao.html";
      } else if (usuarioFinal.nivel === "juridico") {
        location.href = "staff/dashboard.html";
      } else {
        location.href = "tickets.html";
      }

    } catch (e) {
      console.error("Erro na autentica√ß√£o:", e);
      localStorage.clear();
      location.href = "index.html";
    }
  </script>
</body>
</html>
