<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Autenticando</title>
</head>
<body>

<p>Autenticando, aguarde...</p>

<script>
(function () {
  try {
    const hash = window.location.hash;
    if (!hash || !hash.startsWith("#user=")) {
      throw "Payload ausente";
    }

    let raw = hash.replace("#user=", "");
    let usuario;

    try {
      usuario = JSON.parse(decodeURIComponent(raw));
    } catch {
      usuario = JSON.parse(atob(raw));
    }

    if (!usuario || !usuario.id || !usuario.nivel) {
      throw "Usuário inválido";
    }

    localStorage.setItem("usuario", JSON.stringify({
      nome: usuario.nome || usuario.username || "Usuário",
      cid: usuario.id,
      nivel: usuario.nivel
    }));

    location.replace("welcome.html");

  } catch (e) {
    console.error(e);
    location.replace("index.html");
  }
})();
</script>

</body>
</html>
