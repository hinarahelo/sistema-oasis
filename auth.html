<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Autenticando ‚Äî Supremo Tribunal de Oasis</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<p>üîê Finalizando autentica√ß√£o, aguarde...</p>

<script>
(function () {
  try {
    // Remove o #
    const hash = window.location.hash.replace("#", "");

    if (!hash.startsWith("user=")) {
      throw "Payload ausente";
    }

    // Recupera JSON
    const payload = decodeURIComponent(hash.replace("user=", ""));
    const usuario = JSON.parse(payload);

    if (!usuario || !usuario.nivel || !usuario.cid) {
      throw "Usu√°rio inv√°lido";
    }

    // Normaliza estrutura
    const usuarioFinal = {
      nome: usuario.nome,
      cid: usuario.cid,
      nivel: usuario.nivel
    };

    localStorage.setItem("usuario", JSON.stringify(usuarioFinal));

    // Redirecionamento FINAL
    if (usuarioFinal.nivel === "coordenacao") {
      window.location.href = "staff/coordenacao.html";
    } else if (usuarioFinal.nivel === "juridico") {
      window.location.href = "staff/dashboard.html";
    } else {
      window.location.href = "tickets.html";
    }

  } catch (e) {
    console.error("Erro no auth:", e);
    localStorage.clear();
    window.location.href = "index.html";
  }
})();
</script>

</body>
</html>
