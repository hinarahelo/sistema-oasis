<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <title>Jurídico — Supremo Tribunal de Oasis</title>
  <link rel="stylesheet" href="style.css" />
</head>

<body class="bg-paper official">

<script>
  const usuario = JSON.parse(localStorage.getItem("usuario"));
  if (!usuario || usuario.nivel !== "juridico") location.href = "index.html";
</script>

<header class="header official">
  <h1>Painel Jurídico</h1>
</header>

<main class="content official">

<section class="aba active">
  <h2>✏️ Editar Dados do Ticket</h2>

  <label>Nome do Cidadão</label>
  <input id="nomeCidadao">

  <label>ID da Cidade</label>
  <input id="cidCidade">

  <button onclick="salvar()">Salvar</button>
</section>

</main>

<script type="module">
import { doc, updateDoc, addDoc, serverTimestamp } from
"https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
import { db } from "./firebase.js";

const ticketId = localStorage.getItem("ticketAtual");

async function salvar() {
  await updateDoc(doc(db, "tickets", ticketId), {
    nome: nomeCidadao.value,
    cid: cidCidade.value
  });

  await addDoc(collection(db, "logs"), {
    ticket: ticketId,
    acao: "Dados do cidadão alterados",
    usuario: "Jurídico",
    data: serverTimestamp()
  });

  alert("Atualizado com sucesso");
}
</script>

</body>
</html>
