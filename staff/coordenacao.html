<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Painel da CoordenaÃ§Ã£o â€” Supremo Tribunal de Oasis</title>
  <link rel="stylesheet" href="../style.css">
</head>

<body class="bg-paper">

<!-- ðŸ” PROTEÃ‡ÃƒO -->
<script>
  const usuario = JSON.parse(localStorage.getItem("usuario"));
  if (!usuario || usuario.nivel !== "coordenacao") {
    location.href = "../index.html";
  }
</script>

<header class="header official">
  <img src="../logo-oasis.png" class="logo">
  <div class="header-text">
    <h1>ðŸ‘‘ Painel da CoordenaÃ§Ã£o</h1>
    <span>Supremo Tribunal de Oasis</span>
  </div>
</header>

<nav class="nav-bar official">
  <button onclick="mostrarAba('tickets')">ðŸ“‚ Todos os Tickets</button>
  <button onclick="mostrarAba('logs')">ðŸ“œ Auditoria</button>
  <button onclick="sair()">ðŸšª Encerrar SessÃ£o</button>
</nav>

<main class="content official">

<!-- ================= TICKETS ================= -->
<section id="tickets" class="aba active">
  <h2>ðŸ“‚ Controle Geral de Tickets</h2>
  <div id="listaTickets" class="card-list"></div>
</section>

<!-- ================= LOGS ================= -->
<section id="logs" class="aba">
  <h2>ðŸ“œ Logs Oficiais do Sistema</h2>
  <div id="listaLogs" class="card-list"></div>
</section>

</main>

<script type="module">
import {
  collection,
  onSnapshot
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
import { db } from "../firebase.js";

/* ðŸ” ABAS */
window.mostrarAba = id => {
  document.querySelectorAll(".aba").forEach(a => a.classList.remove("active"));
  document.getElementById(id).classList.add("active");
};

/* ðŸšª SAIR */
window.sair = () => {
  localStorage.clear();
  location.href = "../index.html";
};

/* ðŸ“‚ TODOS OS TICKETS */
onSnapshot(collection(db, "tickets"), snap => {
  const box = document.getElementById("listaTickets");
  box.innerHTML = "";

  snap.forEach(d => {
    const t = d.data();
    box.innerHTML += `
      <div class="price-card">
        <b>${t.categoria}</b><br>
        CidadÃ£o: ${t.nome}<br>
        CID: ${t.cid}<br>
        Status: ${t.status}
      </div>
    `;
  });
});

/* ðŸ“œ LOGS */
onSnapshot(collection(db, "logs"), snap => {
  const box = document.getElementById("listaLogs");
  box.innerHTML = "";

  snap.forEach(d => {
    const l = d.data();
    box.innerHTML += `
      <div class="price-card">
        <b>${l.acao}</b><br>
        UsuÃ¡rio: ${l.usuario}<br>
        CID: ${l.cid}<br>
        Data: ${l.data?.toDate().toLocaleString() || ""}
      </div>
    `;
  });
});
</script>

</body>
</html>
