<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Staff â€¢ Tribunal de JustiÃ§a de Oasis</title>
  <link rel="stylesheet" href="../style.css">
</head>

<body class="bg-paper official">

<!-- ğŸ” PROTEÃ‡ÃƒO -->
<script>
  const usuario = JSON.parse(localStorage.getItem("usuario"));
  if (!usuario || !["juridico", "coordenacao"].includes(usuario.nivel)) {
    location.replace("../index.html");
  }
</script>

<header class="header small official">
  <img src="../logo-oasis.png" class="logo small">
  <div class="header-text">
    <h1>Tribunal de JustiÃ§a de Oasis</h1>
    <span>Painel Operacional da Staff</span>
  </div>
</header>

<nav class="nav-bar official">
  <button onclick="abrirAba('abertos')">ğŸ“‚ Abertos</button>
  <button onclick="abrirAba('fechados')">ğŸ§¾ Fechados</button>
  <button onclick="location.href='dashboard.html'">âš–ï¸ CoordenaÃ§Ã£o</button>
  <button onclick="localStorage.clear();location.replace('../index.html')">ğŸšª Sair</button>
</nav>

<main class="content official">

<!-- ================= TICKETS ABERTOS ================= -->
<section id="abertos" class="aba active">
  <h2>ğŸ“‚ Tickets Abertos / Em Atendimento</h2>
  <div id="lista-abertos" class="card-list"></div>
</section>

<!-- ================= CHAT ================= -->
<section id="chat" class="aba">
  <h2 id="chatTitulo">ğŸ’¬ Atendimento</h2>

  <div id="mensagens" class="chat-box official"></div>

  <div class="chat-input official">
    <input id="mensagem" placeholder="Digite a resposta oficial..." />
    <input type="file" id="arquivo" />
    <button class="btn-primary">Enviar</button>
    <button onclick="fecharTicket()" class="btn-secondary">Encerrar Ticket</button>
    <button onclick="abrirAba('abertos')" class="btn-secondary">â¬… Voltar</button>
  </div>
</section>

<!-- ================= TICKETS FECHADOS ================= -->
<section id="fechados" class="aba">
  <h2>ğŸ§¾ Tickets Encerrados</h2>
  <div id="lista-fechados" class="card-list"></div>
</section>

</main>

<!-- ================= CONTROLE DE ABAS ================= -->
<script>
function abrirAba(id) {
  document.querySelectorAll(".aba").forEach(a => a.classList.remove("active"));
  document.getElementById(id)?.classList.add("active");
}
</script>

<!-- LISTAGEM DE TICKETS -->
<script type="module" src="staff.js"></script>

<!-- CHAT (CORRIGIDO) -->
<script type="module">
  import { abrirChat } from "./chat.js";

  // expÃµe para staff.js poder chamar
  window.abrirChat = abrirChat;
</script>

</body>
</html>
