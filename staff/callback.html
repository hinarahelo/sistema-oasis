<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Autentica√ß√£o ‚Äî Supremo Tribunal de Oasis</title>
</head>
<body>
<script>
const params = new URLSearchParams(window.location.search);
const session = params.get("session");
const nivel = params.get("state"); // cidadao | juridico | coordenacao

if (session && nivel) {
  try {
    const usuario = JSON.parse(atob(session));

    // üîí FIXA O N√çVEL REAL
    usuario.nivel = nivel;

    localStorage.setItem("usuario", JSON.stringify(usuario));

    window.history.replaceState({}, document.title, "/staff/");

    if (nivel === "cidadao") location.href = "tickets.html";
    if (nivel === "juridico") location.href = "juridico.html";
    if (nivel === "coordenacao") location.href = "coordenacao.html";
  } catch (e) {
    console.error(e);
    localStorage.removeItem("usuario");
    location.href = "index.html";
  }
} else {
  location.href = "index.html";
}
</script>
</body>
</html>
