<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Atendimento ‚Äî Supremo Tribunal de Oasis</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="../style.css">
</head>

<body class="bg-paper official">

<header class="header official">
  <img src="../logo-oasis.png" class="logo">
  <div class="header-text">
    <h1>Atendimento Jur√≠dico</h1>
    <span>Supremo Tribunal de Oasis</span>
  </div>
</header>

<main class="content official">

  <!-- CHAT -->
  <section class="aba active">

    <div id="mensagens" class="chat-box"></div>

    <!-- PREVIEW -->
    <div id="previewBox" class="hidden" style="margin-bottom:10px;">
      <img id="previewImg" style="max-width:160px;border-radius:10px;">
      <div id="previewFile" style="font-size:12px;"></div>
      <button id="removerArquivo" class="btn-secondary" type="button">
        ‚ùå Remover anexo
      </button>
    </div>

    <!-- INPUT -->
    <div class="chat-input official">
      <input id="mensagem" placeholder="Digite sua resposta..." />
      <input type="file" id="arquivo" />
      <button id="btnEnviar">Enviar</button>
    </div>

  </section>

</main>

<script type="module">
import { abrirChat } from "./chat.js";

/* ==============================
   PREVIEW DE ANEXO
============================== */
const inputArquivo = document.getElementById("arquivo");
const previewBox = document.getElementById("previewBox");
const previewImg = document.getElementById("previewImg");
const previewFile = document.getElementById("previewFile");
const removerBtn = document.getElementById("removerArquivo");

inputArquivo.addEventListener("change", e => {
  const file = e.target.files[0];
  if (!file) return;

  previewBox.classList.remove("hidden");

  if (file.type.startsWith("image/")) {
    previewImg.src = URL.createObjectURL(file);
    previewImg.style.display = "block";
    previewFile.innerText = "";
  } else {
    previewImg.style.display = "none";
    previewFile.innerText = `üìé ${file.name}`;
  }
});

removerBtn.onclick = () => {
  inputArquivo.value = "";
  previewBox.classList.add("hidden");
  previewImg.src = "";
  previewFile.innerText = "";
};

/* ==============================
   ABERTURA DO CHAT
============================== */
const params = new URLSearchParams(location.search);
const ticket = params.get("ticket");

if (!ticket) {
  alert("Ticket inv√°lido.");
  location.href = "dashboard.html";
}

abrirChat(ticket);
</script>

</body>
</html>
